# 地图与导航系统设计文档

## 一、系统概述
地图与导航系统是修仙世界中引导玩家探索和移动的核心机制。通过精心设计的大地图、区域划分和导航功能，为玩家提供直观的世界认知和便捷的移动体验，同时隐藏丰富的探索内容和秘密。

### 设计目标
1. 构建无缝连接的修仙世界地图
2. 实现多样化的区域设计和探索内容
3. 提供直观易用的导航功能
4. 支持快速旅行和传送机制
5. 建立地图与剧情、任务的紧密关联

## 二、地图结构
### 世界地图层级
| 层级 | 描述 | 示例 | 缩放级别 |
|-----|-----|-----|---------|
| 全局地图 | 展示整个修仙世界的宏观地图 | 修真界、魔界、仙界 | 1:10000 |
| 区域地图 | 展示特定区域的详细地图 | 青峰山、烈焰谷、碧波湖 | 1:1000 |
| 场景地图 | 展示具体场景的精确地图 | 青峰山山门、烈焰洞、湖心亭 | 1:100 |

### 区域设计
| 区域类型 | 描述 | 怪物等级 | 资源类型 | 特色 |
|---------|-----|---------|---------|-----|
| 新手区域 | 适合低阶修士的安全区域 | 1-10级 | 基础资源 | 任务引导、低风险 |
| 修炼区域 | 适合中阶修士的冒险区域 | 11-30级 | 中级资源 | 秘境入口、修炼点 |
| 危险区域 | 适合高阶修士的挑战区域 | 31-50级 | 高级资源 | BOSS刷新、稀有材料 |
| 禁区 | 极其危险的禁忌区域 | 51级以上 | 顶级资源 | 超强BOSS、传说宝物 |
| 特殊区域 | 剧情相关或限时开放区域 | 不定 | 特殊资源 | 剧情触发、限时活动 |

## 三、地图探索
### 探索状态
- 未探索：地图区域完全隐藏，显示为迷雾
- 部分探索：地图区域部分显示，关键地点隐藏
- 完全探索：地图区域全部显示，所有地点可见

### 探索奖励
- 地图解锁：解锁新的区域和场景
- 探索成就：完成特定区域探索获得成就
- 隐藏奖励：探索特定地点发现宝箱、秘境或NPC
- 地图碎片：收集碎片解锁完整地图或特殊区域

### 迷雾机制
- 初始状态：所有区域均被迷雾覆盖
- 探索方式：玩家移动到未探索区域自动驱散迷雾
- 记忆保留：已探索区域的迷雾不会重新出现
- 动态迷雾：特殊区域或事件可能导致迷雾重新生成

## 四、导航功能
### 小地图
- 实时显示：当前场景的缩略图
- 标记功能：显示任务目标、NPC、可交互物体位置
- 缩放控制：支持小地图缩放
- 透明度调整：可调整小地图透明度
- 快捷切换：快速切换显示/隐藏小地图

### 大地图
- 全局视图：显示整个游戏世界的地图
- 区域选择：点击区域进入详细视图
- 快速旅行：选择已探索的传送点进行快速旅行
- 标记系统：允许玩家自定义标记地点
- 任务指引：显示当前任务目标位置和路径

### 路径寻路
- 自动寻路：点击地图上的目标点，角色自动移动过去
- 障碍躲避：自动避开地图中的障碍物
- 路径优化：选择最短或最安全的路径
- 寻路中断：遇到敌人或事件时自动中断寻路

### 传送机制
| 传送类型 | 描述 | 消耗 | 限制 |
|---------|-----|-----|-----|
| 传送阵 | 固定位置的传送点 | 灵石 | 已解锁的传送阵之间 |
| 飞行符 | 一次性道具，可传送到指定地点 | 飞行符 | 已探索的区域 |
| 门派传送 | 门派专属传送功能 | 门派贡献 | 门派与主要城市之间 |
| 瞬间移动 | 高阶技能，可瞬间移动短距离 | 灵力 | 冷却时间限制 |

## 五、与其他系统的关联
### 事件驱动交互
1. **地图探索事件**：触发成就系统更新（探索成就进度）、任务系统更新（探索任务完成）
2. **传送事件**：触发场景系统切换（加载新场景）、角色属性系统更新（消耗货币或道具）
3. **标记事件**：触发界面系统更新（地图标记显示）

### 数据交互接口
- IMapDataExport：地图数据导出接口
- INavigationDataExport：导航数据导出接口
- IEventSystem：事件系统接口，用于发布和订阅地图导航相关事件

## 六、数据结构设计
### 地图数据结构
```csharp
public class MapData
{
    public string Id;           // 地图ID
    public string Name;         // 地图名称
    public string Description;  // 地图描述
    public MapType Type;        // 地图类型
    public int LevelRangeMin;   // 最低推荐等级
    public int LevelRangeMax;   // 最高推荐等级
    public Vector2 Size;        // 地图尺寸
    public List<MapRegion> Regions; // 区域列表
    public List<MapPoint> Points;   // 关键地点列表
    public List<传送点> TeleportPoints; // 传送点列表
}
```

### 区域数据结构
```csharp
public class MapRegion
{
    public string Id;           // 区域ID
    public string Name;         // 区域名称
    public Rect Bounds;         // 区域边界
    public RegionType Type;     // 区域类型
    public int ExplorationProgress; // 探索进度(0-100)
    public List<MapPoint> Points;   // 区域内关键地点
}
```

### 关键地点数据结构
```csharp
public class MapPoint
{
    public string Id;           // 点ID
    public string Name;         // 点名称
    public PointType Type;      // 点类型(NPC、宝箱、传送阵等)
    public Vector2 Position;    // 位置坐标
    public bool IsDiscovered;   // 是否已发现
    public string RelatedId;    // 关联ID(NPC、任务等)
    public string Description;  // 描述
}
```

## 七、界面设计
### 小地图界面
- 迷你地图：位于屏幕角落的小地图
- 雷达显示：显示周围敌人、NPC和可交互物体
- 方位指示：显示角色当前朝向
- 缩放按钮：调整小地图大小
- 快速设置：快速访问地图设置

### 大地图界面
- 地图显示：显示整个游戏世界或当前区域的地图
- 区域切换：切换不同层级和区域的地图
- 标记管理：添加、删除和编辑自定义标记
- 传送点列表：显示所有已解锁的传送点
- 任务筛选：显示特定任务的目标位置

### 导航指示界面
- 路径显示：在场景中显示导航路径
- 距离提示：显示到达目标点的距离
- 转向提示：在需要转向时提供提示
- 目标信息：显示目标点的名称和类型

## 八、性能优化策略
1. **地图分片加载**：将大地图分为多个小块，按需加载
2. **LOD技术**：根据距离调整地图细节显示
3. **资源缓存**：缓存常用地图数据，减少加载时间
4. **异步加载**：异步加载地图数据和资源，避免界面卡顿
5. **内存管理**：及时释放不活跃区域的地图资源

## 九、未来拓展方向
1. **动态地图**：地图随时间、季节或事件发生变化
2. **天气系统**：不同天气影响地图可见度和导航
3. **水下地图**：支持水下探索和导航
4. **飞行系统**：允许玩家飞行探索地图
5. **多层地图**：支持地面、地下、空中等多层地图探索
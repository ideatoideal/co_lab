# 战斗系统

## 系统概述
战斗系统是游戏的核心交互机制，采用2D顶视图视角和即时战斗模式，玩家通过移动、攻击、防御、跳跃/穿梭等操作与怪物进行实时战斗，并可通过吞噬机制获得成长。系统强调操作技巧与策略性的结合，鼓励玩家通过不同的战斗风格与吞噬选择实现角色个性化发展。

## 核心战斗机制

### 1. 角色控制
- **移动**：通过方向键或虚拟摇杆控制角色上下左右移动
- **加速跑步**：按住奔跑键进行加速移动，速度提升50%，期间持续消耗体力值（每秒消耗10点体力值）
- **攻击**：点击鼠标左键或攻击按钮释放普通攻击（即时生效，无需等待回合）
- **技能**：点击技能快捷键释放对应技能（即时生效，有冷却时间）
- **防御**：按住防御键进入防御姿态，减少受到的伤害
- **吞噬**：靠近未死亡的怪物长按吞噬键进行整体吞噬；点击地上的怪物肢体进行肢体吞噬
- **跳跃/穿梭**：按下跳跃键进行短距离跳跃或穿梭，可快速避开敌人攻击，跳跃/穿梭期间闪避值提升30%，受到伤害降低20%（消耗50点体力值，有冷却时间，默认10秒）

### 2. 战斗状态
角色和怪物都具有以下基本状态：
| 状态名称 | 描述 |
|---------|-----|
| 生命值 | 角色/怪物的生命上限，归零则死亡 |
| 灵力值 | 释放技能的消耗资源 |
| 攻击速度 | 普通攻击的间隔时间 |
| 移动速度 | 角色/怪物的移动快慢 |
| 防御力 | 减少受到的伤害 |
| 暴击率 | 攻击时触发暴击的概率 |
| 暴击伤害 | 暴击时的伤害倍数 |
| 闪避值 | 躲避敌人攻击的概率 |

### 3. 攻击与伤害计算
- **普通攻击**：基础伤害 = 攻击力 * (1 + 攻击加成) - 目标防御力
- **技能攻击**：技能伤害 = 技能基础值 + 攻击力 * 技能系数 - 目标防御力
- **暴击计算**：当攻击随机数 ≤ 暴击率时触发暴击，伤害 *= 暴击伤害
- **元素伤害**：根据角色元素属性与怪物元素弱点计算额外伤害

## 怪物设计

### 1. 怪物类型
| 类型 | 特点 | 示例 |
|-----|-----|-----|
| 普通怪物 | 基础属性较低，无特殊能力 | 小妖怪、野兽 |
| 精英怪物 | 属性较高，拥有1-2个特殊技能 | 妖怪头目、变异野兽 |
| BOSS怪物 | 高属性、多技能、特殊机制 | 妖王、上古凶兽 |

### 2. 怪物行为模式
- **巡逻**：在固定区域内巡逻
- **探测范围**：每个怪物具有一定的探测范围（根据怪物类型和等级有所不同），玩家进入探测范围前，怪物处于未察觉状态，玩家在探测范围外对怪物不可见
- **追击**：发现玩家（进入探测范围）后主动追击
- **逃跑**：生命值过低时尝试逃跑
- **反击**：受到攻击时有几率反击
- **召唤**：特定怪物可以召唤小弟协助战斗

### 3. 怪物死亡与掉落
- **死亡判定**：生命值归零时死亡
- **肢体掉落**：死亡后有20%-80%几率掉落1-3个肢体（根据怪物稀有度）
- **物品掉落**：BOSS级怪物有几率掉落稀有装备和道具

## 吞噬机制交互

### 1. 整体吞噬
- **触发条件**：怪物未死亡（生命值 ≤ 30%）且处于可吞噬状态
- **吞噬过程**：持续3秒的引导时间，期间角色无法移动和攻击
- **吞噬成功奖励**：
  - 获得100%的怪物属性精华
  - 80%几率获得怪物技能碎片
  - 50%几率获得怪物血脉
  - 饱食度增加80%
- **吞噬失败**：引导过程中受到攻击有50%几率打断，怪物逃脱

### 2. 肢体吞噬
- **触发条件**：拾取怪物死亡后掉落的肢体
- **吞噬过程**： instant吞噬，无需引导时间
- **吞噬奖励**：
  - 获得30%-50%的怪物属性精华（根据肢体类型）
  - 30%几率获得怪物技能碎片
  - 20%几率获得怪物血脉
  - 饱食度增加20%-40%（根据肢体大小）

### 3. 吞噬对比表
| 对比项 | 整体吞噬 | 肢体吞噬 |
|-------|---------|---------|
| 属性精华获取 | 100% | 30%-50% |
| 技能碎片掉率 | 80% | 30% |
| 血脉掉率 | 50% | 20% |
| 饱食度增加 | 80% | 20%-40% |
| 吞噬时间 | 3秒（可被打断） | 瞬间 |
| 风险 | 高 | 低 |

## 战斗流程
1. **发现怪物**：玩家在地图中遇到怪物
2. **进入战斗**：玩家攻击怪物或被怪物发现
3. **战斗交互**：玩家移动、攻击、释放技能；怪物进行反击
4. **吞噬选择**：
   - 选择整体吞噬：在怪物生命值 ≤ 30%时进行
   - 选择击杀后吞噬肢体：将怪物生命值降至0，拾取掉落的肢体
5. **战斗结束**：怪物死亡或玩家死亡/逃脱

## 战斗奖励
- **经验值**：根据怪物等级获得经验，提升角色等级
- **属性精华**：吞噬获得，用于提升角色属性
- **技能碎片**：集齐一定数量可解锁对应技能
- **血脉**：吞噬获得，用于激活或提升血脉能力
- **装备/道具**：怪物死亡后掉落

## 特殊战斗机制

### 1. 连击系统
- 连续攻击怪物可积累连击数
- 连击数达到5/10/20时获得攻击速度/伤害/暴击率加成
- 中断攻击5秒后连击数重置

### 2. 元素克制
- 游戏中有金、木、水、火、土五种元素属性
- 元素克制关系：金克木、木克土、土克水、水克火、火克金
- 攻击克制属性的怪物时，伤害提升30%

### 3.  Boss战斗阶段
- BOSS怪物拥有多个战斗阶段
- 当生命值降至70%/40%/10%时进入新阶段
- 新阶段会解锁新技能或增强原有技能

## 视觉与交互设计

### 1. 战斗画面
- 2D顶视图，角色与怪物的比例适中
- 攻击和技能释放时有明显的特效
- 怪物受到攻击时有受击反馈
- 角色和怪物的血量条显示在头顶

### 2. 吞噬动画
- 整体吞噬：角色周围出现吞噬特效，怪物逐渐被吸入角色体内
- 肢体吞噬：肢体图标飞向角色，伴随小型吞噬特效

### 3. 战斗UI
- 角色生命值和灵力值显示在屏幕左上角
- 技能快捷键显示在屏幕右下角
- 连击数和临时加成显示在屏幕中央上方
- 怪物信息显示在屏幕中央下方

## 与其他系统关联
- **与角色属性系统关联**：战斗获得的属性精华用于提升角色属性
- **与吞噬核心系统关联**：吞噬机制是战斗系统的延伸，通过吞噬获得成长
- **与血脉系统关联**：吞噬怪物血脉可激活或提升角色血脉能力
- **与进化系统关联**：战斗经验和吞噬获得的资源是角色进化的关键

## 未来拓展方向
1. **PVP战斗**：玩家之间的对战功能
2. **多人协作**：组队挑战强大BOSS
3. **战斗宠物**：培养宠物协助战斗
4. **阵法系统**：布置阵法增强战斗能力或限制怪物